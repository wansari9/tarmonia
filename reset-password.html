<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Reset Password - Tarmonia</title>
  <link rel="stylesheet" href="css/style.css">
  <style> .reset-box{max-width:480px;margin:48px auto;padding:24px;background:#fff;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.06);} label{display:block;margin-bottom:8px;} input{width:100%;padding:8px;margin-bottom:12px;} button{padding:10px 16px;background:#72b16a;color:#fff;border:0;border-radius:6px;} .note{color:#666;font-size:13px;} </style>
</head>
<body>
  <div class="reset-box">
    <h2>Set a New Password</h2>
    <p class="note">Enter a new password for your account.</p>
    <form id="resetForm">
      <label>New password</label>
      <input type="password" id="password" required minlength="6">
      <input type="hidden" id="token">
      <button type="submit">Save password</button>
    </form>
    <div id="message" style="margin-top:12px;color:#c00;"></div>
  </div>

  <script>
    (function(){
      const params = new URLSearchParams(window.location.search);
      const token = params.get('token') || '';
      document.getElementById('token').value = token;

      document.getElementById('resetForm').addEventListener('submit', async function(e){
        e.preventDefault();
        const password = document.getElementById('password').value;
        if(password.length < 6){ document.getElementById('message').textContent = 'Password must be at least 6 characters'; return; }
        try{
          const fd = new FormData(); fd.append('token', token); fd.append('password', password);
          const res = await fetch('includes/auth_reset_password.php', { method:'POST', body: fd, credentials: 'same-origin' });
          const j = await res.json();
          if(j.success){ alert('Password updated. Please login.'); window.location.href = 'login.html'; } else { document.getElementById('message').textContent = j.error || 'Failed'; }
        }catch(err){ document.getElementById('message').textContent = 'Server error'; }
      });
    })();
  </script>
</body>
</html>
