<!DOCTYPE html>
<html>
<head>
    <title>Simple Checkout Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 10px 0; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Simple Checkout Test</h1>
    
    <button onclick="testCheckout()">Submit Test Order</button>
    <button onclick="checkDiagnostic()">Run Diagnostic</button>
    <button onclick="location.reload()">Reload Page</button>
    
    <h3>Console Output:</h3>
    <div id="output"></div>
    
    <script>
        function print(msg, isError = false) {
            const div = document.getElementById('output');
            const pre = document.createElement('pre');
            pre.className = isError ? 'error' : 'success';
            pre.textContent = msg;
            div.appendChild(pre);
            console.log(msg);
        }
        
        async function checkDiagnostic() {
            document.getElementById('output').innerHTML = '';
            print('Running diagnostic...');
            
            try {
                const response = await fetch('diagnostic.php');
                const data = await response.json();
                print(JSON.stringify(data, null, 2));
            } catch(e) {
                print('Diagnostic error: ' + e.message, true);
            }
        }
        
        async function testCheckout() {
            document.getElementById('output').innerHTML = '';
            print('Submitting test order to api/checkout.php...');
            
            const orderData = {
                first_name: 'Test',
                last_name: 'User',
                email: 'test@test.com',
                phone: '1234567890',
                address: '123 Test St',
                address2: '',
                city: 'Test City',
                state: 'Test State',
                postal_code: '12345',
                country: 'MY',
                payment_method: 'manual'
            };
            
            print('Request data:\n' + JSON.stringify(orderData, null, 2));
            
            try {
                const response = await fetch('api/checkout.php', {
                    method: 'POST',
                    credentials: 'same-origin',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(orderData)
                });
                
                print('Response status: ' + response.status + ' ' + response.statusText);
                
                const text = await response.text();
                print('Raw response:\n' + text);
                
                try {
                    const data = JSON.parse(text);
                    print('Parsed JSON:\n' + JSON.stringify(data, null, 2));
                    
                    if (data.ok) {
                        print('✅ SUCCESS! Order created:', false);
                        print('Order ID: ' + data.data.order_id, false);
                        print('Order Number: ' + data.data.order_number, false);
                    } else {
                        print('❌ ERROR from API:', true);
                        print(JSON.stringify(data.error, null, 2), true);
                    }
                } catch(e) {
                    print('❌ Response is not valid JSON', true);
                }
                
            } catch(error) {
                print('❌ Network error: ' + error.message, true);
                print(error.stack, true);
            }
        }
        
        // Auto-run diagnostic on load
        window.addEventListener('DOMContentLoaded', checkDiagnostic);
    </script>
</body>
</html>
